<!doctype html>
<html lang="en">
    <head>
        <title>Kwapi monitoring</title>
        <meta charset="utf-8">
        <link rel="stylesheet" href="{{ url_for('v1.static', filename='design.css') }}"/>
        <link rel="icon" type="image/png" href="{{ url_for('v1.static', filename='favicon.png') }}" />
        <script src="{{ url_for('v1.static', filename='javascriptrrd-1.1.1.wlibs.min.js') }}"></script>
        <script type="text/javascript">
        // <![CDATA[
            function reloadGraph(img) {
                var graph_opts={legend: 'None',
                                tooltipOpts: { content: "%y.2 watts" }
                                };
                var ds_graph_opts={'w':{color: "#A12F0A", lines: { show: true, fill: true}, yaxis:2}};
                var id = img.attr('id');
                {% if scale %}
                    var rrd_flot_opts={graph_only: true,
                                       use_rra: true,
                                       rra: {{ ['minute', 'hour', 'day', 'week', 'month', 'year'].index(scale)}},
                                       graph_height: "160px",
                                       graph_width: "232px"
                                       };
                    flot_obj=new rrdFlotAsync(id, null, null, graph_opts, ds_graph_opts, rrd_flot_opts);
                {% else %}
                    var rrd_flot_opts={graph_height: "500px",
                                       graph_width: "1010px"
                                       };
                    flot_obj=new rrdFlotAsync(id, null, null, graph_opts, ds_graph_opts, rrd_flot_opts);
                {% endif %}
                flot_obj.reload("http://localhost:8082/rrd/" + id + "/");
            }

            function reloadAllGraphs() {
                $('.graph').each(function() {
                    reloadGraph($(this));
                });
            }

            $(document).ready(function () {
                setInterval('reloadAllGraphs()', {{ refresh*1000 }});
            });
        // ]]>
        </script>
    </head>
    <body>
        <div id="header"><h1>Kwapi energy monitoring</h1></div>
        <!-- Horizontal menu bar -->
        <div class="menu">
            <ul>
                {% for label in scales %}
                    {% if label == scale %}
                        <li><a class="active" href="/last/{{ label }}/">{{ label }}</a></li>
                    {% else %}
                        <li><a href="/last/{{ label }}/">{{ label }}</a></li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
        <div id="inner">
            <!-- Scale view (all probes for one scale) -->
            {% if view == 'scale' %}
                {% if probes|count > 0 %}
                    <!-- Display all probe graphs -->
                    {% for probe in probes %}
                        <div class="imageSingle">
                            <div class="legend">{{ probe }}</div>
                            <div class="image"><a href="/probe/{{ probe }}"><div id="{{ probe }}" class="graph"></div></a></div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No probes found.</p>
                {% endif %}

            <!-- Probe view (all scales for one probe) -->
            {% elif view == 'probe' %}
                <h2>Probe: {{ probe }}</h2>
                <div id="{{ probe }}" class="graph"></div>
            {% endif %}
        <div id="bottom"></div>
        </div>
        <script type="text/javascript">
        // <![CDATA[
            reloadAllGraphs();
        // ]]>
        </script>
    </body>
</html>
